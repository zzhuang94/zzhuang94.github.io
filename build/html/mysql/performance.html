

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>关于性能 &mdash; zzhuang94.blog just do it documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="zzhuang94.blog just do it documentation" href="../index.html"/>
        <link rel="up" title="MySQL" href="index.html"/>
        <link rel="next" title="技术文档" href="../tech/index.html"/>
        <link rel="prev" title="时区 datetime timestamp" href="time.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> zzhuang94.blog
          

          
          </a>

          
            
            
              <div class="version">
                just do it
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">Linux</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../linux/memo.html">备忘录</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../linux/memo.html#id3">时间戳与时间字符串</a></li>
<li class="toctree-l3"><a class="reference internal" href="../linux/memo.html#args">ARGS 参数传递</a></li>
<li class="toctree-l3"><a class="reference internal" href="../linux/memo.html#git">GIT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../linux/memo.html#jq">jq</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../linux/lsyncd.html">使用lsyncd同步文件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../linux/lsyncd.html#install">install</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MySQL</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="time.html">时区 datetime timestamp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="time.html#mysql">MySQL时区</a></li>
<li class="toctree-l3"><a class="reference internal" href="time.html#datetime-vs-timestamp">datetime VS timestamp</a></li>
<li class="toctree-l3"><a class="reference internal" href="time.html#id2">参考文档</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="">关于性能</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">建表</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">初始化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">存储结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">查询效率</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">关于索引</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tech/index.html">技术文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tech/blog.html">个人博客搭建</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tech/blog.html#id3">简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tech/blog.html#github-pages">Github Pages 个人博客创建</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tech/blog.html#sphinx">Sphinx搭建静态网站</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tech/blog.html#sphinxgithub-pages">Sphinx对接GitHub Pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tech/blog.html#id4">参考文档</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">zzhuang94.blog</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">MySQL</a> &raquo;</li>
      
    <li>关于性能</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/mysql/performance.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><a class="toc-backref" href="#id8">关于性能</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>2017-05-13</li>
</ul>
<div class="contents topic" id="id2">
<p class="topic-title first">目录</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id8">关于性能</a><ul>
<li><a class="reference internal" href="#id3" id="id9">建表</a></li>
<li><a class="reference internal" href="#id4" id="id10">初始化</a></li>
<li><a class="reference internal" href="#id5" id="id11">存储结构</a></li>
<li><a class="reference internal" href="#id6" id="id12">查询效率</a></li>
<li><a class="reference internal" href="#id7" id="id13">关于索引</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id9">建表</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">四张不同引擎，不同索引的表</p>
<div class="highlight-sql"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre> <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">time1</span><span class="o">`</span><span class="p">;</span>
 <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">time1</span><span class="o">`</span> <span class="p">(</span>
   <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="o">`</span><span class="n">num</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">str</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">dt</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">ts</span><span class="o">`</span> <span class="k">timestamp</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
 <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

 <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">time2</span><span class="o">`</span><span class="p">;</span>
 <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">time2</span><span class="o">`</span> <span class="p">(</span>
   <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="o">`</span><span class="n">num</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">str</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">dt</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">ts</span><span class="o">`</span> <span class="k">timestamp</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
   <span class="k">KEY</span> <span class="o">`</span><span class="n">num</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">num</span><span class="o">`</span><span class="p">),</span>
   <span class="k">KEY</span> <span class="o">`</span><span class="n">dt</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">dt</span><span class="o">`</span><span class="p">),</span>
   <span class="k">KEY</span> <span class="o">`</span><span class="n">ts</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">ts</span><span class="o">`</span><span class="p">)</span>
 <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

 <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">time3</span><span class="o">`</span><span class="p">;</span>
 <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">time3</span><span class="o">`</span> <span class="p">(</span>
   <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="o">`</span><span class="n">num</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">str</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">dt</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">ts</span><span class="o">`</span> <span class="k">timestamp</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
 <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

 <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">time4</span><span class="o">`</span><span class="p">;</span>
 <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">time4</span><span class="o">`</span> <span class="p">(</span>
   <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="o">`</span><span class="n">num</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">str</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">dt</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">ts</span><span class="o">`</span> <span class="k">timestamp</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
   <span class="k">KEY</span> <span class="o">`</span><span class="n">num</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">num</span><span class="o">`</span><span class="p">),</span>
   <span class="k">KEY</span> <span class="o">`</span><span class="n">dt</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">dt</span><span class="o">`</span><span class="p">),</span>
   <span class="k">KEY</span> <span class="o">`</span><span class="n">ts</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">ts</span><span class="o">`</span><span class="p">)</span>
 <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id10">初始化</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">导入测试数据，这里使用 <code class="docutils literal"><span class="pre">php</span></code> 脚本来向四张表中导入相同的1000万条相同的数据</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="x"> </span><span class="cp">&lt;?php</span>

 <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;Asia/Shanghai&#39;</span><span class="p">);</span>
 <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

 <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=zzhuang94&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
 <span class="nv">$unix</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
 <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO </span><span class="si">$table</span><span class="s2"> (num, str, dt, ts) values &quot;</span><span class="p">;</span>
     <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="nv">$unix</span> <span class="o">++</span><span class="p">;</span>
         <span class="nv">$time</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">,</span> <span class="nv">$unix</span><span class="p">);</span>
         <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot;(</span><span class="si">$unix</span><span class="s2">, &#39;zzhuang</span><span class="si">$unix</span><span class="s2">&#39;, &#39;</span><span class="si">$time</span><span class="s2">&#39;, &#39;</span><span class="si">$time</span><span class="s2">&#39;),&quot;</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="nv">$sql</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>
     <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">执行数据导入，可以看到：</p>
<ul class="simple">
<li>对于不同引擎使用不同索引的表，插入完全相同的数据，真实执行时间 <em>(19.85s, 20.28s, 19.01s, 19.69s)</em> 相差无几</li>
</ul>
<div class="highlight-shell"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre> <span class="o">[</span>12:33:49<span class="o">]</span> ~/code/php on git:master x <span class="nv">$ </span><span class="nb">time </span>php mysql.php time1
 php mysql.php time1  19.85s user 0.79s system 14% cpu 2:23.38 total
 <span class="o">[</span>12:20:37<span class="o">]</span> ~/code/php on git:master x <span class="nv">$ </span><span class="nb">time </span>php mysql.php time2
 php mysql.php time2  20.28s user 0.76s system 11% cpu 3:11.14 total
 <span class="o">[</span>12:24:07<span class="o">]</span> ~/code/php on git:master x <span class="nv">$ </span><span class="nb">time </span>php mysql.php time3
 php mysql.php time3  19.01s user 0.73s system 20% cpu 1:37.04 total
 <span class="o">[</span>12:26:26<span class="o">]</span> ~/code/php on git:master x <span class="nv">$ </span><span class="nb">time </span>php mysql.php time4
 php mysql.php time4  19.69s user 0.76s system 6% cpu 5:34.05 total
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id11">存储结构</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">各表在磁盘上的真实存储，可以看到：</p>
<ul class="simple">
<li>相同的引擎，不使用索引占空间更小 <em>(time1:576M&lt;time2:1016M;  time3:481M&lt;time4:819M)</em></li>
<li>相同的索引，MyISAM引擎占空间更小 <em>(time3:481M&lt;time1:576M;  time4:819M&lt;time2:1016M)</em></li>
<li>都是以二进制文件的方式存储数据，但是不同的引擎数据存储方式不同<ul>
<li><strong>Innodb</strong> : <code class="docutils literal"><span class="pre">.frm</span></code> 存储表结构， <code class="docutils literal"><span class="pre">.ibd</span></code> 存储表数据 <em>（包括索引信息）</em></li>
<li><strong>MyISAM</strong> : <code class="docutils literal"><span class="pre">.frm</span></code> 存储表结构， <code class="docutils literal"><span class="pre">.MYD</span></code> 存储表数据， <code class="docutils literal"><span class="pre">.MYI</span></code> 存储索引信息 <em>（可以看到，time3和time4的MYD文件大小一样，而MYI文件time4确大了很多，是因为time3只有主键索引，而time4还有三个其它字段的索引）</em></li>
</ul>
</li>
</ul>
<div class="highlight-shell"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre> <span class="o">[</span>12:32:07<span class="o">]</span> /var/lib/mysql/zzhuang94 <span class="nv">$ </span>l
 total 2.9G
 -rw-rw---- <span class="m">1</span> mysql mysql    <span class="m">65</span> May <span class="m">10</span> 23:12 db.opt
 -rw-rw---- <span class="m">1</span> mysql mysql  8.5K May <span class="m">10</span> 23:13 time1.frm
 -rw-rw---- <span class="m">1</span> mysql mysql  576M May <span class="m">20</span> 12:36 time1.ibd
 -rw-rw---- <span class="m">1</span> mysql mysql  8.5K May <span class="m">10</span> 23:13 time2.frm
 -rw-rw---- <span class="m">1</span> mysql mysql 1016M May <span class="m">20</span> 12:24 time2.ibd
 -rw-rw---- <span class="m">1</span> mysql mysql  8.5K May <span class="m">10</span> 23:13 time3.frm
 -rw-rw---- <span class="m">1</span> mysql mysql  382M May <span class="m">20</span> 12:26 time3.MYD
 -rw-rw---- <span class="m">1</span> mysql mysql   99M May <span class="m">20</span> 12:26 time3.MYI
 -rw-rw---- <span class="m">1</span> mysql mysql  8.5K May <span class="m">10</span> 23:13 time4.frm
 -rw-rw---- <span class="m">1</span> mysql mysql  382M May <span class="m">20</span> 12:32 time4.MYD
 -rw-rw---- <span class="m">1</span> mysql mysql  437M May <span class="m">20</span> 12:32 time4.MYI
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id12">查询效率</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>分别对四张表进行同样的查询操作，得到以下结论：<ul>
<li><strong>MyISAM</strong> 引擎会记录全表总记录数，不加条件查找 <strong>COUNT(*)</strong> 可以秒出结果，有条件限制也需要计算</li>
<li>相同的索引情况， <strong>MyISAM</strong> 的查询效率要高于 <strong>InnoDB</strong></li>
<li><strong>时间先后</strong> 比较的场景，使用 <strong>时间戳</strong> 的效率要略高于 <strong>datetime</strong> ，且这两种类型的效率要远远高于 <strong>timestamp</strong></li>
</ul>
</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">SELECT COUNT(*) FROM ${table} WHERE</th>
<th class="head">time1</th>
<th class="head">time2</th>
<th class="head">time3</th>
<th class="head">time4</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>3.78 sec</td>
<td>3.20 sec</td>
<td>0.00 sec</td>
<td>0.00 sec</td>
</tr>
<tr class="row-odd"><td><cite>dt</cite> &gt; &#8216;2017-06-20&#8217; AND <cite>dt</cite> &lt; &#8216;2017-08-20&#8217;</td>
<td>5.45 sec</td>
<td>4.60 sec</td>
<td>5.37 sec</td>
<td>3.68 sec</td>
</tr>
<tr class="row-even"><td><cite>ts</cite> &gt; &#8216;2017-06-20&#8217; AND <cite>ts</cite> &lt; &#8216;2017-08-20&#8217;</td>
<td>18.30 sec</td>
<td>12.29 sec</td>
<td>17.76 sec</td>
<td>12.45 sec</td>
</tr>
<tr class="row-odd"><td><cite>num</cite> &gt; 1497888000 AND <cite>num</cite> &lt; 1503158400</td>
<td>4.22 sec</td>
<td>2.54 sec</td>
<td>2.30 sec</td>
<td>2.50 sec</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">SELECT MAX(num) FROM ${table} WHERE</th>
<th class="head">time1</th>
<th class="head">time2</th>
<th class="head">time3</th>
<th class="head">time4</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>5.07 sec</td>
<td>0.07 sec</td>
<td>2.29 sec</td>
<td>0.09 sec</td>
</tr>
<tr class="row-odd"><td><cite>dt</cite> &gt; &#8216;2017-06-20&#8217; AND <cite>dt</cite> &lt; &#8216;2017-08-20&#8217;</td>
<td>6.25 sec</td>
<td>7.30 sec</td>
<td>3.51 sec</td>
<td>3.83 sec</td>
</tr>
<tr class="row-even"><td><cite>ts</cite> &gt; &#8216;2017-06-20&#8217; AND <cite>ts</cite> &lt; &#8216;2017-08-20&#8217;</td>
<td>18.97 sec</td>
<td>26.22 sec</td>
<td>16.98 sec</td>
<td>18.48 sec</td>
</tr>
<tr class="row-odd"><td><cite>num</cite> &gt; 1497888000 AND <cite>num</cite> &lt; 1503158400</td>
<td>4.77 sec</td>
<td>0.00 sec</td>
<td>2.78 sec</td>
<td>0.00 sec</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id13">关于索引</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">关于上面的测试数据，应该会发现一个明显的问题： <strong>在同样的数据库引擎及同样的查询之下，使用索引并不是总是比不用索引快</strong></p>
</li>
<li><p class="first">但是经过测试会发现：</p>
<ul class="simple">
<li><em>数据量小，使用索引明显效率提升</em></li>
<li><em>数据量大，看不出来使用索引与否与查询效率的关联</em></li>
</ul>
</li>
<li><p class="first">大胆猜测： <strong>如果查询数据量过大，MySQL则不走索引，直接全表查询</strong></p>
</li>
<li><p class="first">借助 <a class="reference external" href="https://dev.mysql.com/doc/refman/5.6/en/explain-output.html">EXPLAIN</a> 查看索引使用情况，印证上述猜测</p>
<div class="highlight-sql"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre> <span class="n">mysql</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">time2</span> <span class="k">where</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="s1">&#39;2017-07-01&#39;</span><span class="p">;</span>
 <span class="o">+</span><span class="c1">----+-------------+-------+------+---------------+------+---------+------+---------+-------------+</span>
 <span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span> <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="k">type</span> <span class="o">|</span> <span class="n">possible_keys</span> <span class="o">|</span> <span class="k">key</span>  <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="k">rows</span>    <span class="o">|</span> <span class="n">Extra</span>       <span class="o">|</span>
 <span class="o">+</span><span class="c1">----+-------------+-------+------+---------------+------+---------+------+---------+-------------+</span>
 <span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">SIMPLE</span>      <span class="o">|</span> <span class="n">time2</span> <span class="o">|</span> <span class="k">ALL</span>  <span class="o">|</span> <span class="n">dt</span>            <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span> <span class="mi">9385444</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">where</span> <span class="o">|</span>
 <span class="o">+</span><span class="c1">----+-------------+-------+------+---------------+------+---------+------+---------+-------------+</span>
 <span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

 <span class="n">mysql</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">time2</span> <span class="k">where</span> <span class="n">dt</span> <span class="o">=</span> <span class="s1">&#39;2017-07-01&#39;</span><span class="p">;</span>
 <span class="o">+</span><span class="c1">----+-------------+-------+------+---------------+------+---------+-------+------+-------+</span>
 <span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span> <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="k">type</span> <span class="o">|</span> <span class="n">possible_keys</span> <span class="o">|</span> <span class="k">key</span>  <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>   <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">Extra</span> <span class="o">|</span>
 <span class="o">+</span><span class="c1">----+-------------+-------+------+---------------+------+---------+-------+------+-------+</span>
 <span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">SIMPLE</span>      <span class="o">|</span> <span class="n">time2</span> <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="n">dt</span>            <span class="o">|</span> <span class="n">dt</span>   <span class="o">|</span> <span class="mi">6</span>       <span class="o">|</span> <span class="n">const</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span> <span class="k">NULL</span>  <span class="o">|</span>
 <span class="o">+</span><span class="c1">----+-------------+-------+------+---------------+------+---------+-------+------+-------+</span>
 <span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">MySQL官方文档， <a class="reference external" href="https://dev.mysql.com/doc/refman/5.6/en/index-btree-hash.html#btree-index-characteristics">B-Tree Index Characteristics</a> 有下面这段话 :)</p>
</li>
</ul>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/btree-index.png"><img alt="../_images/btree-index.png" src="../_images/btree-index.png" style="width: 794.7px; height: 154.8px;" /></a>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tech/index.html" class="btn btn-neutral float-right" title="技术文档" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="time.html" class="btn btn-neutral" title="时区 datetime timestamp" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, zzhuang94.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'just do it',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>